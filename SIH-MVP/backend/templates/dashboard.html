<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Risk Dashboard</title>
    <style>
        body { font-family: sans-serif; background-color: #f0f2f5; margin: 0; padding: 2rem; }
        .container { max-width: 1200px; margin: auto; }
        h1 { text-align: center; color: #333; }
        .status-cards { display: flex; justify-content: space-around; gap: 1rem; flex-wrap: wrap; margin-bottom: 2rem; }
        .card { padding: 2rem; border-radius: 8px; color: white; text-align: center; flex: 1; min-width: 250px; }
        .card.high { background-color: #e74c3c; }
        .card.medium { background-color: #f1c40f; }
        .card.low { background-color: #2ecc71; }
        table { width: 100%; border-collapse: collapse; background-color: white; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #f8f8f8; color: #555; }
        a { color: #3498db; text-decoration: none; }
        a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Student Risk Dashboard</h1>
        <div class="status-cards">
            <div id="high-risk" class="card high"></div>
            <div id="medium-risk" class="card medium"></div>
            <div id="low-risk" class="card low"></div>
        </div>
        <h2>All Students</h2>
        <table id="students-table">
            <thead>
                <tr>
                    <th>Student ID</th>
                    <th>Risk Level</th>
                    <th>Attendance</th>
                    <th>Avg. Score</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', fetchData);

        function fetchData() {
            // This is the corrected fetch call
            fetch('http://localhost:5000/api/students')
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.querySelector('#students-table tbody');
                    const counts = { 'High Risk': 0, 'Medium Risk': 0, 'Low Risk': 0 };
                    
                    tableBody.innerHTML = '';
                    data.forEach(student => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${student.student_id}</td>
                            <td>${student.risk_level}</td>
                            <td>${student.attendance_percentage || 'N/A'}%</td>
                            <td>${(student.avg_test_score || 0).toFixed(1)}</td>
                            <td><a href="http://localhost:5000/api/student/${student.student_id}">View Details</a></td>
                        `;
                        tableBody.appendChild(row);
                        
                        counts[student.risk_level] = (counts[student.risk_level] || 0) + 1;
                    });

                    document.getElementById('high-risk').innerHTML = `<h2>High Risk</h2><p>${counts['High Risk']}</p>`;
                    document.getElementById('medium-risk').innerHTML = `<h2>Medium Risk</h2><p>${counts['Medium Risk']}</p>`;
                    document.getElementById('low-risk').innerHTML = `<h2>Low Risk</h2><p>${counts['Low Risk']}</p>`;
                })
                .catch(error => console.error('Error fetching data:', error));
        }
    </script>
</body>
</html>